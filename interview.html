<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø§Ù„Ù…Ù‚Ø§Ø¨Ù„Ø© - Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ù‚Ø§Ø¨Ù„Ø§Øª Ø§Ù„Ø°ÙƒÙŠØ©</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #60a5fa;
            --primary-dark: #3b82f6;
            --primary-darker: #2563eb;
            --primary-light: #93c5fd;
            --bg-dark: #0f172a;
            --bg-darker: #020617;
            --bg-light: #1e293b;
            --text-primary: #f1f5f9;
            --text-secondary: #cbd5e1;
            --text-muted: #94a3b8;
            --border-color: rgba(96, 165, 250, 0.2);
            --success: #22c55e;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Cairo', sans-serif;
            background: linear-gradient(135deg, var(--bg-dark) 0%, var(--bg-darker) 100%);
            min-height: 100vh;
            direction: rtl;
            padding: 20px;
            color: var(--text-primary);
        }

        .interview-container {
            max-width: 900px;
            margin: 0 auto;
        }

        .interview-header {
            background: rgba(30, 41, 59, 0.8);
            backdrop-filter: blur(30px);
            border: 1px solid var(--border-color);
            border-radius: 25px;
            padding: 35px;
            margin-bottom: 25px;
            box-shadow: 0 8px 30px rgba(0,0,0,0.4);
            text-align: center;
        }

        .interview-header h2 {
            background: linear-gradient(135deg, var(--primary-light), var(--primary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-size: 2rem;
            margin-bottom: 15px;
        }

        .job-title {
            color: var(--text-muted);
            font-size: 1.2rem;
            margin-bottom: 25px;
        }

        .progress-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            font-size: 1rem;
            color: var(--text-muted);
        }

        .question-counter {
            font-weight: 600;
            color: var(--primary-light);
        }

        .progress-bar {
            background: rgba(96, 165, 250, 0.1);
            height: 10px;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.2);
        }

        .progress-fill {
            background: linear-gradient(90deg, var(--primary), var(--primary-dark));
            height: 100%;
            transition: width 0.5s ease;
            box-shadow: 0 0 10px rgba(96, 165, 250, 0.5);
        }

        .question-card {
            background: rgba(30, 41, 59, 0.8);
            backdrop-filter: blur(30px);
            border: 1px solid var(--border-color);
            border-radius: 25px;
            padding: 40px;
            margin-bottom: 25px;
            box-shadow: 0 8px 30px rgba(0,0,0,0.4);
            animation: slideIn 0.5s ease;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .question-label {
            color: var(--text-muted);
            font-size: 0.9rem;
            font-weight: 600;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .question-text {
            color: var(--text-primary);
            font-size: 1.3rem;
            line-height: 1.8;
            margin-bottom: 30px;
            font-weight: 500;
        }

        .answer-section {
            margin-top: 30px;
        }

        .answer-label {
            color: var(--text-secondary);
            font-size: 1rem;
            font-weight: 600;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .answer-input {
            width: 100%;
            min-height: 180px;
            padding: 20px;
            border: 2px solid var(--border-color);
            border-radius: 15px;
            font-size: 1.05rem;
            font-family: 'Cairo', sans-serif;
            resize: vertical;
            transition: all 0.3s;
            background: rgba(15, 23, 42, 0.5);
            color: var(--text-primary);
            line-height: 1.7;
        }

        .answer-input:focus {
            outline: none;
            border-color: var(--primary);
            background: rgba(15, 23, 42, 0.7);
            box-shadow: 0 0 0 4px rgba(96, 165, 250, 0.1);
        }

        .answer-input::placeholder {
            color: var(--text-muted);
            opacity: 0.5;
        }

        .btn-submit {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            border: none;
            padding: 16px 40px;
            border-radius: 15px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 6px 20px rgba(96, 165, 250, 0.4);
            margin-top: 20px;
            width: 100%;
        }

        .btn-submit:hover:not(:disabled) {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(96, 165, 250, 0.5);
        }

        .btn-submit:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .previous-questions {
            margin-top: 40px;
        }

        .previous-questions h3 {
            color: var(--text-primary);
            margin-bottom: 20px;
            font-size: 1.4rem;
        }

        .prev-qa {
            background: rgba(96, 165, 250, 0.05);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 15px;
            border-right: 3px solid rgba(96, 165, 250, 0.4);
        }

        .prev-question {
            color: var(--primary-light);
            font-weight: 600;
            margin-bottom: 10px;
        }

        .prev-answer {
            color: var(--text-muted);
            margin-bottom: 10px;
            font-size: 0.95rem;
        }

        .prev-score {
            display: inline-block;
            background: rgba(96, 165, 250, 0.2);
            color: var(--primary-light);
            padding: 5px 12px;
            border-radius: 12px;
            font-size: 0.85rem;
            font-weight: 600;
        }

        .loading-state {
            text-align: center;
            padding: 60px 20px;
        }

        .spinner {
            width: 70px;
            height: 70px;
            border: 6px solid rgba(96, 165, 250, 0.2);
            border-top: 6px solid var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 25px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .loading-text {
            color: var(--primary-light);
            font-size: 1.3rem;
            font-weight: 600;
        }

        .completion-screen {
            background: rgba(30, 41, 59, 0.9);
            backdrop-filter: blur(30px);
            border: 1px solid var(--border-color);
            border-radius: 25px;
            padding: 60px 40px;
            text-align: center;
            box-shadow: 0 8px 30px rgba(0,0,0,0.4);
            animation: slideIn 0.6s;
        }

        .completion-icon {
            font-size: 5rem;
            margin-bottom: 25px;
        }

        .completion-screen h2 {
            color: var(--success);
            font-size: 2.5rem;
            margin-bottom: 20px;
        }

        .final-score-display {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            font-size: 4rem;
            font-weight: bold;
            padding: 30px;
            border-radius: 20px;
            margin: 30px 0;
            box-shadow: 0 8px 25px rgba(96, 165, 250, 0.4);
        }

        .completion-message {
            color: var(--text-muted);
            font-size: 1.2rem;
            line-height: 1.8;
            margin-bottom: 30px;
        }

        .btn-return {
            background: transparent;
            color: var(--primary);
            border: 2px solid var(--primary);
            padding: 15px 40px;
            border-radius: 15px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-return:hover {
            background: var(--primary);
            color: white;
            transform: translateY(-2px);
        }

        @media (max-width: 768px) {
            .interview-header {
                padding: 25px;
            }

            .interview-header h2 {
                font-size: 1.6rem;
            }

            .question-card {
                padding: 25px;
            }

            .question-text {
                font-size: 1.1rem;
            }

            .final-score-display {
                font-size: 3rem;
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="interview-container" id="interviewContainer">
        <!-- Ø§Ù„Ù…Ø­ØªÙˆÙ‰ ÙŠØªÙ… ØªØ­Ù…ÙŠÙ„Ù‡ Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ§Ù‹ -->
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { 
            getFirestore, 
            doc,
            getDoc,
            updateDoc
        } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyCLn9QQAByyGzI3lD5FBCNGurzbv_kvR7w",
            authDomain: "smart-interview-system-dd643.firebaseapp.com",
            projectId: "smart-interview-system-dd643",
            storageBucket: "smart-interview-system-dd643.firebasestorage.app",
            messagingSenderId: "992351376418",
            appId: "1:992351376418:web:0aa361087e8d33a686667b"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // âœ… DeepSeek Configuration
        const DEEPSEEK_API_KEY = "sk-87a7fe4543404f94b3b1d63385f20424"; 
        const DEEPSEEK_API_URL = "https://api.deepseek.com/v1/chat/completions";

        const MAX_QUESTIONS = 10;
        
        const currentUser = JSON.parse(localStorage.getItem('currentUser') || 'null');
        const currentInterviewData = JSON.parse(localStorage.getItem('currentInterview') || 'null');

        if (!currentUser || !currentInterviewData) {
            window.location.href = 'applicant-dashboard.html';
        }

        let interview = null;
        let job = null;
        let currentAnswer = '';
        let isProcessing = false;

        async function loadInterviewData() {
            try {
                console.log('ğŸ“¥ ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ù‚Ø§Ø¨Ù„Ø©...');
                
                const interviewDoc = await getDoc(doc(db, "interviews", currentInterviewData.interviewId));
                if (!interviewDoc.exists()) {
                    console.error('âŒ Ø§Ù„Ù…Ù‚Ø§Ø¨Ù„Ø© ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯Ø©');
                    window.location.href = 'applicant-dashboard.html';
                    return;
                }
                interview = { id: interviewDoc.id, ...interviewDoc.data() };
                console.log('âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù‚Ø§Ø¨Ù„Ø©:', interview);

                const jobDoc = await getDoc(doc(db, "jobs", currentInterviewData.jobId));
                if (!jobDoc.exists()) {
                    console.error('âŒ Ø§Ù„ÙˆØ¸ÙŠÙØ© ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯Ø©');
                    window.location.href = 'applicant-dashboard.html';
                    return;
                }
                job = { id: jobDoc.id, ...jobDoc.data() };
                console.log('âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙˆØ¸ÙŠÙØ©:', job);

                if (!interview.currentQuestion && interview.questions.length === 0) {
                    await generateNextQuestion();
                } else {
                    renderInterface();
                }
            } catch (error) {
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ù‚Ø§Ø¨Ù„Ø©:', error);
                alert('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù‚Ø§Ø¨Ù„Ø©: ' + error.message);
                window.location.href = 'applicant-dashboard.html';
            }
        }

        function renderInterface() {
            const container = document.getElementById('interviewContainer');
            
            if (interview.status === 'completed') {
                showCompletionScreen();
                return;
            }

            const progress = (interview.questions.length / MAX_QUESTIONS) * 100;

            container.innerHTML = `
                <div class="interview-header">
                    <h2>Ø§Ù„Ù…Ù‚Ø§Ø¨Ù„Ø©</h2>
                    <div class="job-title">Ø§Ù„ÙˆØ¸ÙŠÙØ©: ${job.title}</div>
                    <div class="progress-info">
                        <span class="question-counter">Ø§Ù„Ø³Ø¤Ø§Ù„ ${interview.questions.length + 1} Ù…Ù† ${MAX_QUESTIONS}</span>
                        <span>${Math.round(progress)}%</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: ${progress}%"></div>
                    </div>
                </div>

                ${isProcessing ? `
                    <div class="question-card">
                        <div class="loading-state">
                            <div class="spinner"></div>
                            <div class="loading-text">Ø¬Ø§Ø±Ù Ù…Ø¹Ø§Ù„Ø¬Ø© Ø·Ù„Ø¨Ùƒ...</div>
                            <p style="color: var(--text-muted); margin-top: 15px;">ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø± Ù‚Ù„ÙŠÙ„Ø§Ù‹</p>
                        </div>
                    </div>
                ` : interview.currentQuestion ? `
                    <div class="question-card">
                        <div class="question-label">
                            <span>Ø§Ù„Ø³Ø¤Ø§Ù„ ${interview.questions.length + 1}</span>
                        </div>
                        <div class="question-text">${interview.currentQuestion}</div>

                        <div class="answer-section">
                            <div class="answer-label">
                                <span>Ø¥Ø¬Ø§Ø¨ØªÙƒ:</span>
                            </div>
                            <textarea 
                                class="answer-input" 
                                id="answerInput"
                                placeholder="Ø§ÙƒØªØ¨ Ø¥Ø¬Ø§Ø¨ØªÙƒ Ù‡Ù†Ø§... ÙƒÙ† ÙˆØ§Ø¶Ø­Ø§Ù‹ ÙˆÙ…ÙØµÙ„Ø§Ù‹ Ù‚Ø¯Ø± Ø§Ù„Ø¥Ù…ÙƒØ§Ù†"
                                oninput="window.updateAnswer(this.value)"
                            >${currentAnswer}</textarea>
                            <button 
                                class="btn-submit" 
                                onclick="window.submitAnswer()"
                                ${!currentAnswer.trim() ? 'disabled' : ''}
                                id="submitBtn"
                            >
                                Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø©
                            </button>
                        </div>

                        ${interview.questions.length > 0 ? `
                            <div class="previous-questions">
                                <h3>Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©</h3>
                                ${interview.questions.map((qa, index) => `
                                    <div class="prev-qa">
                                        <div class="prev-question">Ø³${index + 1}: ${qa.question}</div>
                                        <div class="prev-answer"><strong>Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø©:</strong> ${qa.answer.substring(0, 100)}${qa.answer.length > 100 ? '...' : ''}</div>
                                        <div style="margin-top: 10px;">
                                            <span class="prev-score">Ø§Ù„Ø¯Ø±Ø¬Ø©: ${qa.score}/10</span>
                                            <span style="color: var(--text-muted); margin-right: 15px; font-size: 0.9rem;">${qa.feedback}</span>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        ` : ''}
                    </div>
                ` : ''}
            `;

            const answerInput = document.getElementById('answerInput');
            if (answerInput && !isProcessing) {
                answerInput.focus();
            }
        }

        window.updateAnswer = function(value) {
            currentAnswer = value;
            const submitBtn = document.getElementById('submitBtn');
            if (submitBtn) {
                submitBtn.disabled = !value.trim();
            }
        };

        // âœ… Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ DeepSeek API
        async function callDeepSeekAPI(messages, temperature = 0.7) {
            console.log('ğŸ¤– Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ DeepSeek API...');
            
            try {
                const response = await fetch(DEEPSEEK_API_URL, {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                        "Authorization": `Bearer ${DEEPSEEK_API_KEY}`
                    },
                    body: JSON.stringify({
                        model: "deepseek-chat", // Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ
                        messages: messages,
                        temperature: temperature,
                        max_tokens: 2000
                    })
                });

                if (!response.ok) {
                    const errorData = await response.text();
                    console.error('âŒ Ø®Ø·Ø£ Ù…Ù† DeepSeek API:', errorData);
                    throw new Error(`API Error: ${response.status} - ${response.statusText}`);
                }

                const data = await response.json();
                console.log('âœ… Ø§Ø³ØªØ¬Ø§Ø¨Ø© DeepSeek API:', data);
                
                if (!data.choices || !data.choices[0] || !data.choices[0].message) {
                    throw new Error('Ø§Ø³ØªØ¬Ø§Ø¨Ø© ØºÙŠØ± ØµØ§Ù„Ø­Ø© Ù…Ù† API');
                }

                return data.choices[0].message.content;
            } catch (error) {
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ DeepSeek API:', error);
                throw error;
            }
        }

        async function generateNextQuestion() {
            isProcessing = true;
            renderInterface();

            try {
                console.log('ğŸ¤– ØªÙˆÙ„ÙŠØ¯ Ø³Ø¤Ø§Ù„ Ø¬Ø¯ÙŠØ¯...');
                
                const systemMessage = {
                    role: "system",
                    content: `Ø£Ù†Øª Ù…ÙÙ‚Ø§Ø¨ÙÙ„ Ù…Ø­ØªØ±Ù ÙÙŠ Ù…Ø¬Ø§Ù„ Ø§Ù„ØªÙˆØ¸ÙŠÙ Ù…ØªØ®ØµØµ ÙÙŠ ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ù…Ø±Ø´Ø­ÙŠÙ†. Ù…Ù‡Ù…ØªÙƒ Ø·Ø±Ø­ Ø£Ø³Ø¦Ù„Ø© Ø°ÙƒÙŠØ© ÙˆÙ…Ù‡Ù†ÙŠØ©.

Ù‚ÙˆØ§Ø¹Ø¯ Ù…Ù‡Ù…Ø©:
1. Ø§Ø·Ø±Ø­ Ø³Ø¤Ø§Ù„Ø§Ù‹ ÙˆØ§Ø­Ø¯Ø§Ù‹ ÙÙ‚Ø· ÙÙŠ ÙƒÙ„ Ù…Ø±Ø©
2. Ø§Ù„Ø³Ø¤Ø§Ù„ ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ù…Ø¨Ø§Ø´Ø±Ø§Ù‹ ÙˆÙ…Ø­Ø¯Ø¯Ø§Ù‹
3. ÙŠØ¬Ø¨ Ø£Ù† ÙŠØ®ØªØ¨Ø± Ø§Ù„Ù…Ø¹Ø±ÙØ© Ø§Ù„Ø¹Ù…Ù„ÙŠØ©
4. ØªØ¬Ù†Ø¨ ØªÙƒØ±Ø§Ø± Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©
5. Ø§Ù„Ø±Ø¯ ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ø¨ØµÙŠØºØ© JSON ÙÙ‚Ø· Ø¨Ù‡Ø°Ø§ Ø§Ù„Ø´ÙƒÙ„:
{
  "question": "Ù†Øµ Ø§Ù„Ø³Ø¤Ø§Ù„ Ù‡Ù†Ø§"
}`
                };

                const userMessage = {
                    role: "user",
                    content: `Ø£Ù†Ø§ Ø£ÙØ¬Ø±ÙŠ Ù…Ù‚Ø§Ø¨Ù„Ø© Ù„ÙˆØ¸ÙŠÙØ© "${job.title}".

Ø§Ù„Ù…Ù‡Ø§Ø±Ø§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©: ${job.skills}

Ø§Ù„Ø³ÙŠØ§Ù‚:
- Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ù…Ø·Ø±ÙˆØ­Ø© Ø­ØªÙ‰ Ø§Ù„Ø¢Ù†: ${interview.questions.length}
- Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ Ù„Ù„Ø£Ø³Ø¦Ù„Ø©: ${MAX_QUESTIONS}

${interview.questions.length > 0 ? `Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©:
${interview.questions.map((q, i) => `${i + 1}. ${q.question} (Ø§Ù„Ø¯Ø±Ø¬Ø©: ${q.score}/10)`).join('\n')}` : 'Ù„Ù… ÙŠØªÙ… Ø·Ø±Ø­ Ø£Ø³Ø¦Ù„Ø© Ø¨Ø¹Ø¯.'}

Ø§Ø·Ø±Ø­ Ø³Ø¤Ø§Ù„Ø§Ù‹ Ù…Ù‡Ù†ÙŠØ§Ù‹ ÙˆØ§Ø­Ø¯Ø§Ù‹ ÙŠØ®ØªØ¨Ø± ÙˆØ§Ø­Ø¯Ø© Ù…Ù† Ø§Ù„Ù…Ù‡Ø§Ø±Ø§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©. Ø§Ù„Ø±Ø¯ ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† JSON ÙÙ‚Ø·.`
                };

                const aiResponse = await callDeepSeekAPI([systemMessage, userMessage], 0.8);
                
                const questionData = JSON.parse(aiResponse);
                console.log('âœ… Ø§Ù„Ø³Ø¤Ø§Ù„ Ø§Ù„Ù…ÙˆÙ„Ø¯:', questionData);
                
                if (!questionData.question) {
                    throw new Error('Ù„Ù… ÙŠØªÙ… Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ø³Ø¤Ø§Ù„ Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­');
                }
                
                interview.currentQuestion = questionData.question;
                await updateDoc(doc(db, "interviews", interview.id), {
                    currentQuestion: interview.currentQuestion
                });
                
                isProcessing = false;
                renderInterface();

            } catch (err) {
                isProcessing = false;
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ø³Ø¤Ø§Ù„:', err);
                // ØªØ¹ÙŠÙŠÙ† Ø³Ø¤Ø§Ù„ Ø§ÙØªØ±Ø§Ø¶ÙŠ Ø¹Ù†Ø¯ ÙØ´Ù„ API
                interview.currentQuestion = "Ø£Ø®Ø¨Ø±Ù†ÙŠ Ø¹Ù† Ù†ÙØ³Ùƒ ÙˆØ®Ø¨Ø±Ø§ØªÙƒ Ø§Ù„Ù…Ù‡Ù†ÙŠØ©.";
                await updateDoc(doc(db, "interviews", interview.id), {
                    currentQuestion: interview.currentQuestion
                });
                renderInterface();
            }
        }

        window.submitAnswer = async function() {
            if (!currentAnswer.trim() || isProcessing) return;

            isProcessing = true;
            renderInterface();

            try {
                console.log('ğŸ¤– ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø©...');
                
                const systemMessage = {
                    role: "system",
                    content: `Ø£Ù†Øª Ø®Ø¨ÙŠØ± ØªÙ‚ÙŠÙŠÙ… ÙÙŠ Ù…Ø¬Ø§Ù„ Ø§Ù„ØªÙˆØ¸ÙŠÙ. Ù…Ù‡Ù…ØªÙƒ ØªÙ‚ÙŠÙŠÙ… Ø¥Ø¬Ø§Ø¨Ø§Øª Ø§Ù„Ù…Ø±Ø´Ø­ÙŠÙ† Ø¨Ù…ÙˆØ¶ÙˆØ¹ÙŠØ©.

Ù…Ø¹Ø§ÙŠÙŠØ± Ø§Ù„ØªÙ‚ÙŠÙŠÙ…:
1. Ø§Ù„Ø¯Ù‚Ø© Ø§Ù„ÙÙ†ÙŠØ© (0-3 Ù†Ù‚Ø§Ø·)
2. Ø§Ù„ÙˆØ¶ÙˆØ­ ÙˆØ§Ù„ØªÙ†Ø¸ÙŠÙ… (0-3 Ù†Ù‚Ø§Ø·)
3. Ø§Ù„Ø¹Ù…Ù‚ Ø§Ù„Ù…Ø¹Ø±ÙÙŠ (0-2 Ù†Ù‚Ø§Ø·)
4. Ù…Ø¯Ù‰ Ø§Ù„Ù…Ù„Ø§Ø¡Ù…Ø© Ù„Ù„ÙˆØ¸ÙŠÙØ© (0-2 Ù†Ù‚Ø§Ø·)

ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ø§Ù„Ø±Ø¯ Ø¨ØµÙŠØºØ© JSON ÙÙ‚Ø· Ø¨Ù‡Ø°Ø§ Ø§Ù„Ø´ÙƒÙ„:
{
  "score": Ø±Ù‚Ù… Ù…Ù† 0 Ø¥Ù„Ù‰ 10,
  "feedback": "ØªØ¹Ù„ÙŠÙ‚ Ù‚ØµÙŠØ± ÙˆÙ…ÙÙŠØ¯ (Ø¬Ù…Ù„ØªØ§Ù† ÙƒØ­Ø¯ Ø£Ù‚ØµÙ‰)"
}`
                };

                const userMessage = {
                    role: "user",
                    content: `Ø§Ù„Ø³Ø¤Ø§Ù„ Ø§Ù„Ù…Ø·Ø±ÙˆØ­: ${interview.currentQuestion}

Ø§Ù„Ù…Ù‡Ø§Ø±Ø§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© Ù„Ù„ÙˆØ¸ÙŠÙØ©: ${job.skills}

Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„Ù…ØªÙ‚Ø¯Ù…:
"${currentAnswer}"

Ù‚ÙŠÙ‘Ù… Ù‡Ø°Ù‡ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø¹Ø§ÙŠÙŠØ± Ø§Ù„Ù…Ø°ÙƒÙˆØ±Ø©. Ø§Ù„Ø±Ø¯ ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† JSON ÙÙ‚Ø·.`
                };

                const aiResponse = await callDeepSeekAPI([systemMessage, userMessage], 0.3);
                
                const evaluation = JSON.parse(aiResponse);
                console.log('âœ… Ø§Ù„ØªÙ‚ÙŠÙŠÙ…:', evaluation);

                if (typeof evaluation.score !== 'number' || !evaluation.feedback) {
                    throw new Error('ØªÙ‚ÙŠÙŠÙ… ØºÙŠØ± ØµØ§Ù„Ø­');
                }

                // Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù† Ø§Ù„Ø¯Ø±Ø¬Ø© Ø¨ÙŠÙ† 0 Ùˆ 10
                evaluation.score = Math.max(0, Math.min(10, evaluation.score));

                interview.questions.push({
                    question: interview.currentQuestion,
                    answer: currentAnswer,
                    score: evaluation.score,
                    feedback: evaluation.feedback
                });

                const totalScore = interview.questions.reduce((sum, q) => sum + q.score, 0);
                interview.finalScore = Math.round((totalScore / (interview.questions.length * 10)) * 100);

                if (interview.questions.length >= MAX_QUESTIONS) {
                    interview.status = 'completed';
                    interview.currentQuestion = null;
                    
                    await updateDoc(doc(db, "interviews", interview.id), {
                        questions: interview.questions,
                        currentQuestion: null,
                        status: 'completed',
                        finalScore: interview.finalScore
                    });
                    
                    isProcessing = false;
                    showCompletionScreen();
                    return;
                }

                interview.currentQuestion = null;
                currentAnswer = '';
                
                await updateDoc(doc(db, "interviews", interview.id), {
                    questions: interview.questions,
                    currentQuestion: null,
                    finalScore: interview.finalScore
                });

                isProcessing = false;
                
                setTimeout(generateNextQuestion, 1000);

            } catch (err) {
                isProcessing = false;
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø©:', err);
                // ØªÙ‚ÙŠÙŠÙ… Ø§ÙØªØ±Ø§Ø¶ÙŠ Ø¹Ù†Ø¯ ÙØ´Ù„ API
                const evaluation = { score: 5, feedback: "ØªÙ… ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø¨Ø´ÙƒÙ„ Ø§ÙØªØ±Ø§Ø¶ÙŠ Ø¨Ø³Ø¨Ø¨ Ø®Ø·Ø£ ÙÙ†ÙŠ." };

                interview.questions.push({
                    question: interview.currentQuestion,
                    answer: currentAnswer,
                    score: evaluation.score,
                    feedback: evaluation.feedback
                });

                const totalScore = interview.questions.reduce((sum, q) => sum + q.score, 0);
                interview.finalScore = Math.round((totalScore / (interview.questions.length * 10)) * 100);

                if (interview.questions.length >= MAX_QUESTIONS) {
                    interview.status = 'completed';
                    interview.currentQuestion = null;

                    await updateDoc(doc(db, "interviews", interview.id), {
                        questions: interview.questions,
                        currentQuestion: null,
                        status: 'completed',
                        finalScore: interview.finalScore
                    });

                    showCompletionScreen();
                    return;
                }

                interview.currentQuestion = null;
                currentAnswer = '';

                await updateDoc(doc(db, "interviews", interview.id), {
                    questions: interview.questions,
                    currentQuestion: null,
                    finalScore: interview.finalScore
                });

                setTimeout(generateNextQuestion, 1000);
        };

        function showCompletionScreen() {
            const container = document.getElementById('interviewContainer');
            
            container.innerHTML = `
                <div class="completion-screen">
                    <div class="completion-icon">ğŸ‰</div>
                    <h2>ØªÙ… Ø¥Ù†Ù‡Ø§Ø¡ Ø§Ù„Ù…Ù‚Ø§Ø¨Ù„Ø© Ø¨Ù†Ø¬Ø§Ø­!</h2>
                    <div class="final-score-display">${interview.finalScore}%</div>
                    <div class="completion-message">
                        <p>ØªÙ… ØªÙ‚ÙŠÙŠÙ… <strong>${interview.questions.length}</strong> Ø³Ø¤Ø§Ù„ Ø¨Ù†Ø¬Ø§Ø­</p>
                        <p style="margin-top: 15px; color: var(--success); font-weight: 600;">
                            Ø³ÙŠØªÙ… Ù…Ø±Ø§Ø¬Ø¹Ø© Ø·Ù„Ø¨Ùƒ Ù…Ù† Ù‚Ø¨Ù„ ÙØ±ÙŠÙ‚ Ø§Ù„ØªÙˆØ¸ÙŠÙ Ù‚Ø±ÙŠØ¨Ø§Ù‹
                        </p>
                    </div>
                    <button class="btn-return" onclick="window.returnToDashboard()">
                        Ø§Ù„Ø¹ÙˆØ¯Ø© Ø¥Ù„Ù‰ Ø§Ù„ÙˆØ¸Ø§Ø¦Ù
                    </button>
                </div>
            `;

            localStorage.removeItem('currentInterview');

            setTimeout(() => {
                window.location.href = 'applicant-dashboard.html';
            }, 5000);
        }

        window.returnToDashboard = function() {
            window.location.href = 'applicant-dashboard.html';
        };

        loadInterviewData();
    </script>
</body>
</html>
